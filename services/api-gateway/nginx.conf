# services/api-gateway/nginx.conf
server {
    # Gateway sẽ lắng nghe trên cổng 80
    listen 80;

    # --- Route cho Frontend (React App) ---
    # Bất kỳ request nào không phải API sẽ được chuyển đến React
    location / {
        # 'web-react' là tên service trong docker-compose.yml
        # 3000 là port mà React service đang chạy (theo Dockerfile ở trên)
        proxy_pass http://web-react:3000; 
        
        # Cấu hình headers để pass-through
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Cấu hình này rất QUAN TRỌNG để React (Vite) hot-reload (HMR)
        # hoạt động qua Nginx
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # --- Route cho Backend (User Service) ---
    # Bất kỳ request nào có dạng /api/users/...
    location /api/users/ {
        # 'user-service' là tên service trong docker-compose.yml
        # 8001 là port mà user-service đang chạy
        proxy_pass http://user-service:8001; 
        
        # Cấu hình headers
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # (Sau này, bạn sẽ thêm các service khác ở đây)
    # location /api/opportunities/ {
    #    proxy_pass http://opportunity-service:8002; 
    # }
}